<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Usuario - Alcaldía La Libertad Este</title>
  <link rel="stylesheet" href="mis-datos.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .home-wrapper {
      padding: 1.5em 1em 0;
      display: flex;
      justify-content: center;
    }

    .card-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2em;
      max-width: 900px;
    }

    .card-box {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
      text-align: center;
    }

    .card-box i {
      font-size: 2.5em;
      margin-bottom: 0.5em;
    }

    .card-box:hover {
      transform: scale(1.05);
    }

    .perfil-card { background-color: #0074D9; }
    .formulario-card { background-color: #2ECC40; }
    .reportes-card { background-color: #FF851B; }
    .cerrar-card { background-color: #FF4136; }

    .seccion {
      display: none;
      background-color: rgba(255,255,255,0.95);
      padding: 1.5em;
      margin: 1em auto 0.5em;
      max-width: 700px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .seccion.activa { display: block; }

    .campo {
      margin: 0.5em 0;
    }

    .firma-img {
      max-width: 200px;
      margin-top: 0.5em;
    }

    /* Botón verde institucional */
    .btn-verde {
      background-color: #2e7d32;
      color: white;
      border: none;
      padding: 0.6em 1.2em;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 1em;
    }
  </style>
</head>
<body class="fondo-datos">
  <header class="encabezado">
    <h1>Panel de Usuario</h1>
    <p>Bienvenido al módulo de consulta personal</p>
  </header>

  <!-- Cards elevadas -->
  <main class="home-wrapper">
    <div class="card-container">
      <div class="card-box perfil-card" onclick="abrirSeccion('perfilDatos')">
        <i class="fas fa-user"></i>
        Perfil
      </div>
      <div class="card-box formulario-card" onclick="registrarAccesoFormulario()">
        <i class="fas fa-file-alt"></i>
        Formulario
      </div>
      <div class="card-box reportes-card" onclick="registrarAccesoReportes()">
        <i class="fas fa-chart-bar"></i>
        Reportes
      </div>
      <div class="card-box cerrar-card" onclick="cerrarSesion()">
        <i class="fas fa-sign-out-alt"></i>
        Cerrar sesión
      </div>

      <!-- Botón solo visible para administrador -->
      <div id="accionesAdmin"></div>
    </div>
  </main>

  <!-- Sección Perfil -->
  <section class="seccion" id="perfilDatos">
    <div class="campo"><strong>Usuario:</strong> <span id="campo-usuario">Cargando...</span></div>
    <div class="campo"><strong>Correo institucional:</strong> <span id="campo-correo">Cargando...</span></div>
    <div class="campo"><strong>Rol:</strong> <span id="campo-rol">Cargando...</span></div>
    <div class="campo firma-digital">
      <strong>Firma digital:</strong><br />
      <img src="" alt="Firma Digital" class="firma-img" id="firma-img" />
    </div>
  </section>

  <!-- Scripts -->
  <script src="mis-datos.js"></script>
  <script>
    function abrirSeccion(id) {
      const target = document.getElementById(id);
      const isVisible = target.classList.contains('activa');
      document.querySelectorAll('.seccion').forEach(sec => sec.classList.remove('activa'));
      if (!isVisible) {
        target.classList.add('activa');
      }
    }

    function cerrarSesion() {
      localStorage.removeItem("usuarioActivo");
      window.location.href = "login.html";
    }

    // Mostrar botón solo si el rol es Administrador
    document.addEventListener("DOMContentLoaded", () => {
      const rol = localStorage.getItem("rolActivo");
      if (rol === "Administrador") {
        const btn = document.createElement("button");
        btn.textContent = "Agregar usuario";
        btn.className = "btn-verde";
        btn.onclick = () => window.location.href = "agregar-usuario.html";
        document.getElementById("accionesAdmin").appendChild(btn);
      }
    });
  </script>

  <!-- Overlay emergente -->
  <div id="overlay" class="overlay">
    <div class="overlay-box">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Dirigiendo al Formulario Único de Solicitud…</p>
    </div>
  </div>
</body>
</html>
