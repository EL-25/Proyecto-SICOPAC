<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Formulario Único de Solicitud - Página 2</title>
  <link rel="stylesheet" href="/styleform.css">
</head>

<body>
  <div class="container">

    <form method="POST" action="/guardar">
      <!-- Campos ocultos para datos de la página 1 -->
      <% if (typeof page1Data !== 'undefined') { %>
        <% Object.keys(page1Data).forEach(key => { %>
          <input type="hidden" name="<%= key %>" value="<%= page1Data[key] %>">
        <% }) %>
      <% } %>

      <!-- Campos ocultos adicionales para registrar acción -->
      <input type="hidden" name="usuario" value="<%= page1Data.usuario %>">
      <input type="hidden" name="fechaHoraLocal" id="fechaHoraLocal">

      <fieldset>
        <legend>Datos del titular del asiento</legend>

        <label>Tipo de Documento de Identificación:</label>
        <input type="radio" name="docTitular" value="DUI" id="duiTitularRadio"> DUI
        <input type="radio" name="docTitular" value="NUI" id="nuiTitularRadio"> NIT
        <input type="radio" name="docTitular" value="Otro" id="otroTitularRadio"> Otro
        <br><br>

        <div id="campoDUI_Titular" style="display:none;">
          <label>Número de DUI:</label>
          <input type="text" id="duiTitularInput" name="duiTitular" disabled>
        </div>

        <div id="campoNUI_Titular" style="display:none;">
          <label>Número de NIT:</label>
          <input type="text" id="nuiTitularInput" name="nuiTitular" disabled>
        </div>

        <div id="campoOtro_Titular" style="display:none;">
          <label>Especifique otro documento:</label>
          <input type="text" id="otroTitularInput" name="otroTitular" disabled>
        </div>
      </fieldset>

      <label>Nombre:</label><br>
      <input type="text" name="primerNombreTitular" placeholder="Primer Nombre">
      <input type="text" name="segundoNombreTitular" placeholder="Segundo Nombre">
      <input type="text" name="primerApellidoTitular" placeholder="Primer Apellido">
      <input type="text" name="segundoApellidoTitular" placeholder="Segundo Apellido">
      <button type="button" id="btnTercerApellidoTitular">+ Añadir Tercer Apellido</button>
      <input type="text" name="tercerApellidoTitular" id="tercerApellidoTitular" placeholder="Tercer Apellido" style="display:none;">
      <br><br>

      <label>Fecha del hecho o acto jurídico:</label>
      <input type="date" name="fechaHecho"><br><br>

      <label>Lugar del hecho o acto jurídico:</label>
      <input type="text" name="lugarHecho" id="lugarHecho" placeholder="Seleccione primero una declaración de la solicitud"><br><br>

      <fieldset>
        <legend>Nombre de la madre</legend>
        <input type="text" name="primerNombreMadre" placeholder="Primer Nombre">
        <input type="text" name="segundoNombreMadre" placeholder="Segundo Nombre">
        <input type="text" name="primerApellidoMadre" placeholder="Primer Apellido">
        <input type="text" name="segundoApellidoMadre" placeholder="Segundo Apellido">
        <input type="text" name="tercerApellidoMadre" placeholder="Tercer Apellido (opcional)">
      </fieldset>
      
      <fieldset>
        <legend>Nombre del padre</legend>
        <input type="text" name="primerNombrePadre" placeholder="Primer Nombre">
        <input type="text" name="segundoNombrePadre" placeholder="Segundo Nombre">
        <input type="text" name="primerApellidoPadre" placeholder="Primer Apellido">
        <input type="text" name="segundoApellidoPadre" placeholder="Segundo Apellido">
      </fieldset>

      <fieldset>
        <legend>Declaración de la solicitud</legend>
        <label><input type="radio" name="declaracion" value="Nacimiento"> Nacimiento</label><br>
        <label><input type="radio" name="declaracion" value="Matrimonio"> Matrimonio</label><br>
        <label><input type="radio" name="declaracion" value="Union"> Unión no matrimonial</label>
      </fieldset>

      <fieldset>
        <legend>Descripción de la Documentación Presentada</legend>

        <% const docItems = [
          "Defunción en", "Registro de Defunción Fetal", "Estado Familiar adquirido en el extranjero",
          "Nacimiento en el extranjero", "Reposición", "Anotaciones Marginales", "Cancelación",
          "Modificaciones", "Acta de reconocimiento", "Resolución Sustitutiva del Régimen Patrimonial",
          "Rectificaciones", "Subsanaciones", "Anotaciones a un asiento posterior", "Otros"
        ]; %>

        <% docItems.forEach(item => { %>
          <label><input type="checkbox" name="doc[]" value="<%= item %>"> <%= item %></label>
        <% }) %>

        <hr>

        <% const doc2Items = [
          "Fecha Médica de Nacimiento", "Testimonio de Escritura Pública", "Certificación de Sentencia Ejecutoriada",
          "Certificación de Línea Legal", "Certificado Médico de Defunción", "Autorización de juez",
          "Hecho en extranjero", "Resolución Administrativa", "Resolución Judicial"
        ]; %>

        <% doc2Items.forEach(item => { %>
          <label><input type="checkbox" name="doc2[]" value="<%= item %>"> <%= item %></label>
        <% }) %>
      </fieldset>

      <div class="botones">
        <a href="/" class="btn">← Regresar</a>
        <button type="reset">Limpiar</button>
        <button type="submit">Enviar</button>
      </div>

    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const $ = (id) => document.getElementById(id);

      function activarOpciones(radioName, map) {
        const radios = document.getElementsByName(radioName);
        radios.forEach(radio => {
          radio.addEventListener("change", () => {
            for (const key in map) {
              const cfg = map[key];
              const cont = $(cfg.contenedor);
              const input = $(cfg.input);
              const radioElem = $(cfg.radio);
              if (cont && input && radioElem) {
                const activo = radioElem.checked;
                cont.style.display = activo ? "block" : "none";
                input.disabled = !activo;
                if (!activo) input.value = "";
              }
            }
          });
        });
      }

      activarOpciones("docTitular", {
        duiT: { radio: "duiTitularRadio", contenedor: "campoDUI_Titular", input: "duiTitularInput" },
        nuiT: { radio: "nuiTitularRadio", contenedor: "campoNUI_Titular", input: "nuiTitularInput" },
        otroT: { radio: "otroTitularRadio", contenedor: "campoOtro_Titular", input: "otroTitularInput" }
      });

      // Capturar hora local del navegador
      const fechaHoraLocalInput = document.getElementById("fechaHoraLocal");
      if (fechaHoraLocalInput) {
        fechaHoraLocalInput.value = new Date().toLocaleString();
      }

      // Mostrar campo de tercer apellido del titular
      const btnTercerApellidoTitular = document.getElementById("btnTercerApellidoTitular");
      const tercerApellidoTitular = document.getElementById("tercerApellidoTitular");
      
      if (btnTercerApellidoTitular && tercerApellidoTitular) {
        btnTercerApellidoTitular.addEventListener("click", () => {
          tercerApellidoTitular.style.display = "inline-block";
          btnTercerApellidoTitular.style.display = "none";
        });
      }

      // Validación manual al enviar
      const form = document.querySelector("form");
      form.addEventListener("submit", (e) => {
        const nombre = document.querySelector("[name='primerNombreTitular']");
        const apellido = document.querySelector("[name='primerApellidoTitular']");
        
        if (!nombre.value.trim() || !apellido.value.trim()) {
          e.preventDefault();
          alert("Debe completar al menos el primer nombre y primer apellido del titular.");
          nombre.focus();
        }
      
      });

      // Autocompletar lugar según la declaración seleccionada
      const lugarHechoInput = document.getElementById("lugarHecho");
      const declaracionCheckboxes = document.querySelectorAll("input[name='declaracion']");
      
      declaracionCheckboxes.forEach(chk => {
        chk.addEventListener("change", () => {
          if (chk.checked) {
            switch (chk.value) {
              case "Nacimiento":
                lugarHechoInput.value = "Hospital / Clínica / Domicilio";
                break;
                case "Matrimonio":
                  lugarHechoInput.value = "Alcaldía / Iglesia / Juzgado / Notaría";
                  break;
                  case "Union":
                    lugarHechoInput.value = "Alcaldía / Juzgado";
                    break;
                    default:
                      lugarHechoInput.value = "";
                    }
                  }
                });
              });            
});
  </script>
</body>
</html>
